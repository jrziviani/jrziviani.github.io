<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Class Inheritance in C | ziviani.net</title>
<meta name=keywords content="C,Python">
<meta name=description content="Implementing class inheritance in C language - or how Python implements class inheritance support in C.">
<meta name=author content="Jose R. Ziviani">
<link rel=canonical href=https://ziviani.net/posts/class-inheritance-in-c/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<link rel=icon href=https://ziviani.net/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://ziviani.net/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://ziviani.net/favicon-32x32.png>
<link rel=apple-touch-icon href=https://ziviani.net/apple-touch-icon.png>
<link rel=mask-icon href=https://ziviani.net/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.0">
<link rel=alternate hreflang=en href=https://ziviani.net/posts/class-inheritance-in-c/>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="Class Inheritance in C">
<meta property="og:description" content="Implementing class inheritance in C language - or how Python implements class inheritance support in C.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://ziviani.net/posts/class-inheritance-in-c/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2014-12-24T06:18:30-08:00">
<meta property="article:modified_time" content="2014-12-24T06:18:30-08:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Class Inheritance in C">
<meta name=twitter:description content="Implementing class inheritance in C language - or how Python implements class inheritance support in C.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ziviani.net/posts/"},{"@type":"ListItem","position":2,"name":"Class Inheritance in C","item":"https://ziviani.net/posts/class-inheritance-in-c/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Class Inheritance in C","name":"Class Inheritance in C","description":"Implementing class inheritance in C language - or how Python implements class inheritance support in C.","keywords":["C","Python"],"articleBody":"C language doesn’t offer support for object oriented programming, but it’s not necessarily an obstacle. Actually, it’s been used behind the scenes for a long time. Let’s see how Python interpretor implements it own class inheritance in C.\nThe Python Way Python is an object oriented language, it’s possible to write a base class and classes deriving (subclasses) from it. However, the interpretor (CPython) is written in C and, as mentioned, C doesn’t offer such support. So, let’s see how they implement it.\nPyObject is the base class in Python, it’s the mother of everybody else. But, in C, it’s a simple struct with some fields #defined _HEAD_, which are inhered (actually it’s defined) by any of its subclass.\n// http://svn.python.org/view/python/trunk/Include/object.h  ... #define _PyObject_HEAD_EXTRA  #define _PyObject_EXTRA_INIT  ... #define PyObject_HEAD \\ _PyObject_HEAD_EXTRA \\ Py_ssize_t ob_refcnt; \\ struct _typeobject *ob_type;  #define PyObject_VAR_HEAD \\ PyObject_HEAD \\ Py_ssize_t ob_size; /* Number of items in variable part */ typedef struct _object { PyObject_HEAD } PyObject; See below the children of PyObject: PyStringObject, PyFloatObject, and PyListObject. But how do I know that they’re children of PyObject? It’ll be clearer later, but take a look at the structures definitions, they all have PyObject_HEAD or PyObject_VAR_HEAD (which also starts with PyObject_HEAD) field.\n// http://svn.python.org/view/python/trunk/Include/stringobject.h  typedef struct { PyObject_VAR_HEAD long ob_shash; int ob_sstate; char ob_sval[1]; } PyStringObject; // http://svn.python.org/view/python/trunk/Include/floatobject.h  typedef struct { PyObject_HEAD double ob_fval; } PyFloatObject; // http://svn.python.org/view/python/trunk/Include/listobject.h  typedef struct { PyObject_VAR_HEAD PyObject **ob_item; Py_ssize_t allocated; } PyListObject; A simple class diagram could be made from those structures:\nCasting Here the magic begins. In the code below focus on return ((PyListObject*)op)-ob_item[i].\nDo you know type casting? In a nutshell, it’s the way to force the conversion between two different data types. In C, casts are usually dangerous and must be used wisely.\n// http://svn.python.org/view/python/trunk/Objects/listobject.c?view=markup  PyObject *PyList_GetItem(PyObject *op, Py_ssize_t i) { if (!PyList_Check(op)) { PyErr_BadInternalCall(); return NULL; } if (i  0 || i = Py_SIZE(op)) { if (indexerr == NULL) { indexerr = PyString_FromString(\"list index out of range\"); if (indexerr == NULL) return NULL; } PyErr_SetObject(PyExc_IndexError, indexerr); return NULL; } return ((PyListObject *)op)-ob_item[i]; } See, op is a data pointer of a PyObject type. That ((PyListObject*)op) casts (forced conversion) op to a PyListObject type (note the PyList_Check(op) as a sanity check). Then it accesses ob_item field to return the i item. Note that ob_item is an array of PyObject data pointers as correctly specified in the function signature.\nThose structures (PyObject and PyList) are completely different, why don’t that break the program?\nIn this particular case, the conversion is safe and well behaved because it’s defined by the C99 standard..\n Within a structure object, the non-bit-field members and the units in which bit-fields reside have addresses that increase in the order in which they are declared. A pointer to a structure object, suitably cast, points to its initial member (or if that member is a bit-field, then to the unit in which it resides), and vice versa. There may therefore be unnamed holes within a structure object, but not at its beginning, as necessary to achieve the appropriate alignment.\n Basically, it means that a pointer to any struct always point to its first element (declaration order), so you can cast it to any other struct if (and only if) its first field have the same type. The compiler will handle different sizeof(struct) for us.\nShow me some code Based on a sample C code, let’s go through the not-optimized code generated by GCC to see how it’s implemented.\n1 #include 2 #include 3 4 #define HEAD int type; 5 6 enum { INTEGER, FLOAT }; 7 8 typedef struct 9 { 10 HEAD 11 } Number; 12 13 typedef struct 14 { 15 HEAD 16 int val; 17 } Integer; 18 19 typedef struct 20 { 21 HEAD 22 float val; 23 } Float; 24 25 int main() 26 { 27 Integer i; 28 i.type = INTEGER; 29 i.val = 42; 30 31 Float f; 32 f.type = FLOAT; 33 f.val = 36.85; 34 35 Number **numbers = (Number**)malloc(sizeof(Number*) * 2); 36 37 numbers[0] = (Number*)\u0026i; 38 numbers[1] = (Number*)\u0026f; 39 40 // for debugging purpose ↓ 41 int y = ((Integer*)numbers[0])-val; 42 43 int x = numbers[0]-type; 44 x = numbers[1]-type; 45 // for debugging purpose ↑ 46 47 for (unsigned int count = 0; count  2; ++count) 48 { 49 switch (numbers[count]-type) 50 { 51 case INTEGER: 52 printf(\"%d - Integer: %d\\n\", 53 count, 54 ((Integer*)numbers[count])-val); 55 break; 56 57 case FLOAT: 58 printf(\"%d - Float: %.2f\\n\", 59 count, 60 ((Float*)numbers[count])-val); 61 break; 62 63 default: 64 break; 65 } 66 } 67 68 free(numbers); 69 70 return 0; 71 } # Compiling: $ gcc -g -std=c99 code.c -o codebin # Running: $ ./codebin 0 - Integer: 42 1 - Float: 36.85  Now let’s see the internals.\nNumber **numbers = (Number**)malloc(sizeof(Number*) * 2);  0x4005e3 main+38 mov $0x10,%edi 0x4005e8 main+43 callq 0x4004c0 malloc@plt 0x4005ed main+48 mov %rax,-0x8(%rbp) (gdb) info registers rax rax 0x602010 6299664 (gdb) x/wx $rbp-0x8 0x7fffffffe3c8: 0x00602010 (gdb) x/wx 0x00602010 0x602010: 0x00000000 The malloc() function gets the size stored in edi register and writes the memory address in rax. That address is copied to rbp-0x8, the place of our variable numbers in the stack.\nnumbers[0] = (Number*)\u0026i;  0x4005f1 main+52 mov -0x8(%rbp),%rax 0x4005f5 main+56 lea -0x20(%rbp),%rdx 0x4005f9 main+60 mov %rdx,(%rax) (gdb) x/wx $rbp-0x20 0x7fffffffe3b0: 0x00000000 (gdb) x/2wx 0x00602010 0x602010: 0xffffe3b0 0x00007fff Register rbp-0x8 (AKA “numbers”) is copied to rax, the address of rbp-0x20 (address of struct “i”) is copied into rdx, and the content of rdx (address of “i”) is stored in the heap. The instruction mov %rdx,(%rax) copies the rdx content into the place where rax content is pointing to, which is the memory that malloc() gave to me. Note that rbp-0x20 is the place of Integer first element.\n Important: the address of a local variable (stack) was stored in the heap, fortunately we are running everything in main(). But it can be dangerous in other scenarios. Read about stack frames.\n int y = ((Integer*)numbers[0])-val;  0x40060b main+78 mov -0x8(%rbp),%rax (gdb) info registers rax rax 0x602010 6299664 0x40060f main+82 mov (%rax),%rax (gdb) info registers rax rax 0x7fffffffe3b0 140737488348080 (gdb) x/wx 0x7fffffffe3b0+4 0x7fffffffe3b4: 0x0000002a == (42 int) 0x400612 main+85 mov 0x4(%rax),%eax (gdb) info registers eax eax 0x2a 42 0x400615 main+88 mov %eax,-0x28(%rbp) (gdb) x/wx $rbp-0x28 0x7fffffffe3a8: 0x0000002a Note that the cast to Integer “grants” a Number variable access to a field that only Integer has defined (val).\nint x = numbers[0]-type;  0x400618 main+91 mov -0x8(%rbp),%rax 0x40061c main+95 mov (%rax),%rax 0x40061f main+98 mov (%rax),%eax (gdb) info registers rax rax 0x0 0 0x400621 main+100 mov %eax,-0x24(%rbp) (gdb) x/wx $rbp-0x24 0x7fffffffe3ac: 0x00000000 x = numbers[1]-type;  0x400624 main+103 mov -0x8(%rbp),%rax (gdb) info registers rax rax 0x602010 6299664 0x400628 main+107 add $0x8,%rax (gdb) info registers rax rax 0x602018 6299672 0x40062c main+111 mov (%rax),%rax (gdb) x/2wx 0x602018 0x602018: 0xffffe3c0 0x00007fff (gdb) x/wx 0x7fffffffe3c0 0x7fffffffe3c0: 0x00000001 0x40062f main+114 mov (%rax),%eax (gdb) info registers rax rax 0x7fffffffe3c0 140737488348096 (gdb) info registers eax eax 0x1 1 0x400631 main+116 mov %eax,-0x24(%rbp) (gdb) x/wx $rbp-0x24 0x7fffffffe3ac: 0x00000001 Conclusion Class inheritance in C is not as elegant/easy as it is in other languages, but it can be achieved. Anyway, as we saw above, there’re several pitfalls that could cause damage to you system. Such technique must be used diligently.\nReferences  https://en.wikipedia.org/wiki/Call_stack#Structure http://flash-gordon.me.uk/ansi.c.txt http://svn.python.org/view/  ","wordCount":"1215","inLanguage":"en","datePublished":"2014-12-24T06:18:30-08:00","dateModified":"2014-12-24T06:18:30-08:00","author":{"@type":"Person","name":"Jose R. Ziviani"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ziviani.net/posts/class-inheritance-in-c/"},"publisher":{"@type":"Organization","name":"ziviani.net","logo":{"@type":"ImageObject","url":"https://ziviani.net/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://ziviani.net/ accesskey=h title="ziviani.net (Alt + H)">ziviani.net</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
<ul class=lang-switch><li>|</li>
<li>
<a href=https://ziviani.net/pt/ title=Portuguese aria-label=:pt:>Pt</a>
</li>
</ul>
</span>
</div>
<ul id=menu>
<li>
<a href=https://ziviani.net/archives title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://ziviani.net/search title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
<li>
<a href=https://ziviani.net/tags title=Tags>
<span>Tags</span>
</a>
</li>
<li>
<a href=https://ziviani.net/about title=About>
<span>About</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://ziviani.net/>Home</a>&nbsp;»&nbsp;<a href=https://ziviani.net/posts/>Posts</a></div>
<h1 class=post-title>
Class Inheritance in C
</h1>
<div class=post-meta><span title="2014-12-24 06:18:30 -0800 -0800">December 24, 2014</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Jose R. Ziviani
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#the-python-way aria-label="The Python Way">The Python Way</a></li>
<li>
<a href=#casting aria-label=Casting>Casting</a></li>
<li>
<a href=#show-me-some-code aria-label="Show me some code">Show me some code</a></li>
<li>
<a href=#conclusion aria-label=Conclusion>Conclusion</a></li>
<li>
<a href=#references aria-label=References>References</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>C language doesn&rsquo;t offer support for object oriented programming, but it&rsquo;s not necessarily an obstacle. Actually, it&rsquo;s been used behind the scenes for a long time. Let&rsquo;s see how Python interpretor implements it own class inheritance in C.</p>
<h3 id=the-python-way>The Python Way<a hidden class=anchor aria-hidden=true href=#the-python-way>#</a></h3>
<p>Python is an object oriented language, it&rsquo;s possible to write a base class and classes deriving (subclasses) from it. However, the interpretor (CPython) is written in C and, as mentioned, C doesn&rsquo;t offer such support. So, let&rsquo;s see how they implement it.</p>
<p>PyObject is the <em>base class</em> in Python, it&rsquo;s the mother of everybody else. But, in C, it&rsquo;s a simple <code>struct</code> with some fields <code>#defined _HEAD_</code>, which are inhered (actually it&rsquo;s defined) by any of its subclass.</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    <span style=color:#586e75>// http://svn.python.org/view/python/trunk/Include/object.h
</span><span style=color:#586e75></span>    ...
    <span style=color:#719e07>#define _PyObject_HEAD_EXTRA
</span><span style=color:#719e07></span>    <span style=color:#719e07>#define _PyObject_EXTRA_INIT
</span><span style=color:#719e07></span>    ...
    
    <span style=color:#719e07>#define PyObject_HEAD                   \
</span><span style=color:#719e07>        _PyObject_HEAD_EXTRA                \
</span><span style=color:#719e07>        Py_ssize_t ob_refcnt;               \
</span><span style=color:#719e07>        struct _typeobject *ob_type;
</span><span style=color:#719e07></span>     
    <span style=color:#719e07>#define PyObject_VAR_HEAD \
</span><span style=color:#719e07>        PyObject_HEAD \
</span><span style=color:#719e07>        Py_ssize_t ob_size; </span><span style=color:#586e75>/* Number of items in variable part */</span><span style=color:#719e07>
</span><span style=color:#719e07></span>     
    <span style=color:#719e07>typedef</span> <span style=color:#719e07>struct</span> _object {
        PyObject_HEAD
    } PyObject;</code></pre></div>
<p>See below the children of <code>PyObject</code>: <code>PyStringObject</code>, <code>PyFloatObject</code>, and <code>PyListObject</code>. <strong>But how do I know that they&rsquo;re children of PyObject?</strong> It&rsquo;ll be clearer later, but take a look at the structures definitions, they all have <code>PyObject_HEAD</code> or <code>PyObject_VAR_HEAD</code> (which also starts with <code>PyObject_HEAD</code>) field.</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    <span style=color:#586e75>// http://svn.python.org/view/python/trunk/Include/stringobject.h
</span><span style=color:#586e75></span>    <span style=color:#719e07>typedef</span> <span style=color:#719e07>struct</span> {
        PyObject_VAR_HEAD
        <span style=color:#dc322f>long</span> ob_shash;
        <span style=color:#dc322f>int</span> ob_sstate;
        <span style=color:#dc322f>char</span> ob_sval[<span style=color:#2aa198>1</span>];
    } PyStringObject;
     
    <span style=color:#586e75>// http://svn.python.org/view/python/trunk/Include/floatobject.h
</span><span style=color:#586e75></span>    <span style=color:#719e07>typedef</span> <span style=color:#719e07>struct</span> {
        PyObject_HEAD
        <span style=color:#dc322f>double</span> ob_fval;
    } PyFloatObject;
     
    <span style=color:#586e75>// http://svn.python.org/view/python/trunk/Include/listobject.h
</span><span style=color:#586e75></span>    <span style=color:#719e07>typedef</span> <span style=color:#719e07>struct</span> {
        PyObject_VAR_HEAD
        PyObject <span style=color:#719e07>**</span>ob_item;
        Py_ssize_t allocated;
    } PyListObject;</code></pre></div>
<p>A simple class diagram could be made from those structures:</p>
<p><img loading=lazy src=/pyobject_diagram.png alt="PyObject object diagram">
</p>
<h3 id=casting>Casting<a hidden class=anchor aria-hidden=true href=#casting>#</a></h3>
<p>Here the magic begins. In the code below focus on <code>return ((PyListObject*)op)->ob_item[i]</code>.</p>
<p>Do you know <a href=http://en.cppreference.com/w/c/language/cast>type casting</a>? In a nutshell, it&rsquo;s the way to force the conversion between two different data types. In C, casts are usually dangerous and must be used wisely.</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    <span style=color:#586e75>// http://svn.python.org/view/python/trunk/Objects/listobject.c?view=markup
</span><span style=color:#586e75></span>    PyObject <span style=color:#719e07>*</span><span style=color:#268bd2>PyList_GetItem</span>(PyObject <span style=color:#719e07>*</span>op, Py_ssize_t i)
    {
        <span style=color:#719e07>if</span> (<span style=color:#719e07>!</span>PyList_Check(op)) {
            PyErr_BadInternalCall();
            <span style=color:#719e07>return</span> <span style=color:#b58900>NULL</span>;
        }
    
        <span style=color:#719e07>if</span> (i <span style=color:#719e07>&lt;</span> <span style=color:#2aa198>0</span> <span style=color:#719e07>||</span> i <span style=color:#719e07>&gt;=</span> Py_SIZE(op)) {
            <span style=color:#719e07>if</span> (indexerr <span style=color:#719e07>==</span> <span style=color:#b58900>NULL</span>) {
                indexerr <span style=color:#719e07>=</span> PyString_FromString(<span style=color:#2aa198>&#34;list index out of range&#34;</span>);
                <span style=color:#719e07>if</span> (indexerr <span style=color:#719e07>==</span> <span style=color:#b58900>NULL</span>)
                    <span style=color:#719e07>return</span> <span style=color:#b58900>NULL</span>;
            }
            PyErr_SetObject(PyExc_IndexError, indexerr);
            <span style=color:#719e07>return</span> <span style=color:#b58900>NULL</span>;
        }
        <span style=color:#719e07>return</span> ((PyListObject <span style=color:#719e07>*</span>)op)<span style=color:#719e07>-&gt;</span>ob_item[i];
    }</code></pre></div>
<p>See, <code>op</code> is a data pointer of a <code>PyObject</code> type. That <code>((PyListObject*)op)</code> casts (forced conversion) <code>op</code> to a <code>PyListObject</code> type (note the <code>PyList_Check(op)</code> as a sanity check). Then it accesses <code>ob_item</code> field to return the <code>i</code> item. Note that <code>ob_item</code> is an array of <code>PyObject</code> data pointers as correctly specified in the function signature.</p>
<p><strong>Those structures (PyObject and PyList) are completely different, why don&rsquo;t that break the program?</strong></p>
<p>In this particular case, the conversion is safe and well behaved because it&rsquo;s defined by the <a href=http://flash-gordon.me.uk/ansi.c.txt>C99 standard.</a>.</p>
<blockquote>
<p>Within a structure object, the non-bit-field members and the units in which bit-fields reside have addresses that increase in the order in which they are declared. A pointer to a structure object, suitably cast, points to its initial member (or if that member is a bit-field, then to the unit in which it resides), and vice versa. There may therefore be unnamed holes within a structure object, but not at its beginning, as necessary to achieve the appropriate alignment.</p>
</blockquote>
<p>Basically, it means that a <strong>pointer to any <code>struct</code> always point to its first element</strong> (declaration order), so you can cast it to any other <code>struct</code> if (and only if) its first field have the same type. The compiler will handle different <code>sizeof(struct)</code> for us.</p>
<h3 id=show-me-some-code>Show me some code<a hidden class=anchor aria-hidden=true href=#show-me-some-code>#</a></h3>
<p>Based on a sample C code, let&rsquo;s go through the not-optimized code generated by GCC to see how it&rsquo;s implemented.</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 1</span>    <span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;stdlib.h&gt;</span><span style=color:#719e07>
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 2</span><span style=color:#719e07></span>    <span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;stdio.h&gt;</span><span style=color:#719e07>
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 3</span><span style=color:#719e07></span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050"> 4</span>    <span style=color:#719e07>#define HEAD int type;
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 5</span><span style=color:#719e07></span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050"> 6</span>    <span style=color:#719e07>enum</span> { INTEGER, FLOAT };
<span style="margin-right:.4em;padding:0 .4em;color:#495050"> 7</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050"> 8</span>    <span style=color:#719e07>typedef</span> <span style=color:#719e07>struct</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050"> 9</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">10</span>        HEAD
<span style="margin-right:.4em;padding:0 .4em;color:#495050">11</span>    } Number;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">12</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">13</span>    <span style=color:#719e07>typedef</span> <span style=color:#719e07>struct</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">14</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">15</span>        HEAD
<span style="margin-right:.4em;padding:0 .4em;color:#495050">16</span>        <span style=color:#dc322f>int</span> val;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">17</span>    } Integer;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">18</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">19</span>    <span style=color:#719e07>typedef</span> <span style=color:#719e07>struct</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">20</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">21</span>        HEAD
<span style="margin-right:.4em;padding:0 .4em;color:#495050">22</span>        <span style=color:#dc322f>float</span> val;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">23</span>    } Float;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">24</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">25</span>    <span style=color:#dc322f>int</span> <span style=color:#268bd2>main</span>()
<span style="margin-right:.4em;padding:0 .4em;color:#495050">26</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">27</span>        Integer i;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">28</span>        i.type <span style=color:#719e07>=</span> INTEGER;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">29</span>        i.val  <span style=color:#719e07>=</span> <span style=color:#2aa198>42</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">30</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">31</span>        Float f;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">32</span>        f.type <span style=color:#719e07>=</span> FLOAT;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">33</span>        f.val  <span style=color:#719e07>=</span> <span style=color:#2aa198>36.85</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">34</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">35</span>        Number <span style=color:#719e07>**</span>numbers <span style=color:#719e07>=</span> (Number<span style=color:#719e07>**</span>)malloc(<span style=color:#719e07>sizeof</span>(Number<span style=color:#719e07>*</span>) <span style=color:#719e07>*</span> <span style=color:#2aa198>2</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#495050">36</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">37</span>        numbers[<span style=color:#2aa198>0</span>] <span style=color:#719e07>=</span> (Number<span style=color:#719e07>*</span>)<span style=color:#719e07>&amp;</span>i;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">38</span>        numbers[<span style=color:#2aa198>1</span>] <span style=color:#719e07>=</span> (Number<span style=color:#719e07>*</span>)<span style=color:#719e07>&amp;</span>f;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">39</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">40</span>        <span style=color:#586e75>// for debugging purpose ↓
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">41</span><span style=color:#586e75></span>        <span style=color:#dc322f>int</span> y <span style=color:#719e07>=</span> ((Integer<span style=color:#719e07>*</span>)numbers[<span style=color:#2aa198>0</span>])<span style=color:#719e07>-&gt;</span>val;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">42</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">43</span>        <span style=color:#dc322f>int</span> x <span style=color:#719e07>=</span> numbers[<span style=color:#2aa198>0</span>]<span style=color:#719e07>-&gt;</span>type;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">44</span>        x <span style=color:#719e07>=</span> numbers[<span style=color:#2aa198>1</span>]<span style=color:#719e07>-&gt;</span>type;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">45</span>        <span style=color:#586e75>// for debugging purpose ↑
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">46</span><span style=color:#586e75></span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">47</span>        <span style=color:#719e07>for</span> (<span style=color:#dc322f>unsigned</span> <span style=color:#dc322f>int</span> count <span style=color:#719e07>=</span> <span style=color:#2aa198>0</span>; count <span style=color:#719e07>&lt;</span> <span style=color:#2aa198>2</span>; <span style=color:#719e07>++</span>count)
<span style="margin-right:.4em;padding:0 .4em;color:#495050">48</span>        {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">49</span>            <span style=color:#719e07>switch</span> (numbers[count]<span style=color:#719e07>-&gt;</span>type)
<span style="margin-right:.4em;padding:0 .4em;color:#495050">50</span>            {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">51</span>                <span style=color:#719e07>case</span> INTEGER:
<span style="margin-right:.4em;padding:0 .4em;color:#495050">52</span>                    printf(<span style=color:#2aa198>&#34;%d - Integer: %d</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>, 
<span style="margin-right:.4em;padding:0 .4em;color:#495050">53</span>                            count, 
<span style="margin-right:.4em;padding:0 .4em;color:#495050">54</span>                            ((Integer<span style=color:#719e07>*</span>)numbers[count])<span style=color:#719e07>-&gt;</span>val);
<span style="margin-right:.4em;padding:0 .4em;color:#495050">55</span>                    <span style=color:#719e07>break</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">56</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">57</span>                <span style=color:#719e07>case</span> FLOAT:
<span style="margin-right:.4em;padding:0 .4em;color:#495050">58</span>                    printf(<span style=color:#2aa198>&#34;%d - Float: %.2f</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>, 
<span style="margin-right:.4em;padding:0 .4em;color:#495050">59</span>                            count, 
<span style="margin-right:.4em;padding:0 .4em;color:#495050">60</span>                            ((Float<span style=color:#719e07>*</span>)numbers[count])<span style=color:#719e07>-&gt;</span>val);
<span style="margin-right:.4em;padding:0 .4em;color:#495050">61</span>                    <span style=color:#719e07>break</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">62</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">63</span>                <span style=color:#719e07>default</span><span style=color:#719e07>:</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">64</span>                    <span style=color:#719e07>break</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">65</span>            }
<span style="margin-right:.4em;padding:0 .4em;color:#495050">66</span>        }
<span style="margin-right:.4em;padding:0 .4em;color:#495050">67</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">68</span>        free(numbers);
<span style="margin-right:.4em;padding:0 .4em;color:#495050">69</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">70</span>        <span style=color:#719e07>return</span> <span style=color:#2aa198>0</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">71</span>    }</code></pre></div>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console>    # Compiling:
    $ gcc -g -std=c99 code.c -o codebin
    
    # Running:
    $ ./codebin
    0 - Integer: 42
    1 - Float: 36.85
</code></pre></div>
<p>Now let&rsquo;s see the internals.</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm>    <span style=color:#268bd2>Number</span> **<span style=color:#cb4b16>numbers</span> = (<span style=color:#cb4b16>Number</span>**)<span style=color:#cb4b16>malloc</span>(<span style=color:#cb4b16>sizeof</span>(<span style=color:#cb4b16>Number</span>*) * <span style=color:#2aa198>2</span>)<span style=color:#586e75>;
</span><span style=color:#586e75></span>    
    <span style=color:#2aa198>0x4005e3</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>38</span>&gt;      <span style=color:#cb4b16>mov</span>    <span style=color:#cb4b16>$0x10</span>,<span style=color:#268bd2>%edi</span>
    0<span style=color:#268bd2>x4005e8</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>43</span>&gt;      <span style=color:#cb4b16>callq</span>  <span style=color:#2aa198>0x4004c0</span> &lt;<span style=color:#cb4b16>malloc@plt</span>&gt;
    0<span style=color:#268bd2>x4005ed</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>48</span>&gt;      <span style=color:#cb4b16>mov</span>    <span style=color:#268bd2>%rax</span>,-<span style=color:#2aa198>0x8</span>(<span style=color:#268bd2>%rbp</span>)
    
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>info</span> <span style=color:#cb4b16>registers</span> <span style=color:#cb4b16>rax</span>
    <span style=color:#268bd2>rax</span>            <span style=color:#2aa198>0x602010</span> <span style=color:#2aa198>6299664</span>
    
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>x</span>/<span style=color:#cb4b16>wx</span> <span style=color:#cb4b16>$rbp-0x8</span>
    0x7fffffffe3c8: 0<span style=color:#268bd2>x00602010</span>
    
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>x</span>/<span style=color:#cb4b16>wx</span> <span style=color:#2aa198>0x00602010</span>
    0x602010:       0<span style=color:#268bd2>x00000000</span></code></pre></div>
<p>The <code>malloc()</code> function gets the size stored in <code>edi</code> register and writes the memory address in <code>rax</code>. That address is copied to <code>rbp-0x8</code>, the place of our variable <strong>numbers</strong> in the stack.</p>
<p><img loading=lazy src=/c_poly_malloc.png alt="malloc instructions">
</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm>    <span style=color:#268bd2>numbers</span>[<span style=color:#2aa198>0</span>] = (<span style=color:#cb4b16>Number</span>*)&amp;<span style=color:#cb4b16>i</span><span style=color:#586e75>;
</span><span style=color:#586e75></span>    
    <span style=color:#2aa198>0x4005f1</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>52</span>&gt;      <span style=color:#cb4b16>mov</span>    -<span style=color:#2aa198>0x8</span>(<span style=color:#268bd2>%rbp</span>),<span style=color:#268bd2>%rax</span>
    0<span style=color:#268bd2>x4005f5</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>56</span>&gt;      <span style=color:#cb4b16>lea</span>    -<span style=color:#2aa198>0x20</span>(<span style=color:#268bd2>%rbp</span>),<span style=color:#268bd2>%rdx</span>
    0<span style=color:#268bd2>x4005f9</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>60</span>&gt;      <span style=color:#cb4b16>mov</span>    <span style=color:#268bd2>%rdx</span>,(<span style=color:#268bd2>%rax</span>)
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>x</span>/<span style=color:#cb4b16>wx</span> <span style=color:#cb4b16>$rbp-0x20</span>
    0x7fffffffe3b0: 0<span style=color:#268bd2>x00000000</span>
    
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>x</span>/<span style=color:#2aa198>2</span><span style=color:#cb4b16>wx</span> <span style=color:#2aa198>0x00602010</span>
    0x602010:       0<span style=color:#268bd2>xffffe3b0</span>      <span style=color:#2aa198>0x00007fff</span></code></pre></div>
<p>Register <code>rbp-0x8</code> (AKA &ldquo;numbers&rdquo;) is copied to <code>rax</code>, the address of <code>rbp-0x20</code> (address of struct &ldquo;i&rdquo;) is copied into <code>rdx</code>, and the content of <code>rdx</code> (address of &ldquo;i&rdquo;) is stored in the heap. The instruction <strong><code>mov %rdx,(%rax)</code></strong> copies the <code>rdx</code> content into the place where <code>rax</code> content is pointing to, which is the memory that <code>malloc()</code> gave to me. Note that <code>rbp-0x20</code> is the place of <code>Integer</code> first element.</p>
<p><img loading=lazy src=/c_poly_cast1.png alt="assembly instructions">
</p>
<blockquote>
<p><strong>Important</strong>: the address of a local variable (stack) was stored in the heap, fortunately we are running everything in <code>main()</code>. But it can be dangerous in other scenarios. Read about <a href=https://en.wikipedia.org/wiki/Call_stack#Structure>stack frames</a>.</p>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm>    <span style=color:#268bd2>int</span> <span style=color:#cb4b16>y</span> = ((<span style=color:#cb4b16>Integer</span>*)<span style=color:#cb4b16>numbers</span>[<span style=color:#2aa198>0</span>])-&gt;<span style=color:#cb4b16>val</span><span style=color:#586e75>;
</span><span style=color:#586e75></span>    
    <span style=color:#2aa198>0x40060b</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>78</span>&gt;      <span style=color:#cb4b16>mov</span>    -<span style=color:#2aa198>0x8</span>(<span style=color:#268bd2>%rbp</span>),<span style=color:#268bd2>%rax</span>
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>info</span> <span style=color:#cb4b16>registers</span> <span style=color:#cb4b16>rax</span>
    <span style=color:#268bd2>rax</span>            <span style=color:#2aa198>0x602010</span> <span style=color:#2aa198>6299664</span>
    
    0<span style=color:#268bd2>x40060f</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>82</span>&gt;      <span style=color:#cb4b16>mov</span>    (<span style=color:#268bd2>%rax</span>),<span style=color:#268bd2>%rax</span>
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>info</span> <span style=color:#cb4b16>registers</span> <span style=color:#cb4b16>rax</span>
    <span style=color:#268bd2>rax</span>            <span style=color:#2aa198>0x7fffffffe3b0</span>   <span style=color:#2aa198>140737488348080</span>
    
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>x</span>/<span style=color:#cb4b16>wx</span> <span style=color:#2aa198>0x7fffffffe3b0</span>+<span style=color:#2aa198>4</span>
    0x7fffffffe3b4: 0<span style=color:#268bd2>x0000002a</span> ==&gt; (<span style=color:#2aa198>42</span> <span style=color:#cb4b16>int</span>)
    
    0<span style=color:#268bd2>x400612</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>85</span>&gt;      <span style=color:#cb4b16>mov</span>    <span style=color:#2aa198>0x4</span>(<span style=color:#268bd2>%rax</span>),<span style=color:#268bd2>%eax</span>
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>info</span> <span style=color:#cb4b16>registers</span> <span style=color:#cb4b16>eax</span>
    <span style=color:#268bd2>eax</span>            <span style=color:#2aa198>0x2a</span>     <span style=color:#2aa198>42</span>
    
    0<span style=color:#268bd2>x400615</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>88</span>&gt;      <span style=color:#cb4b16>mov</span>    <span style=color:#268bd2>%eax</span>,-<span style=color:#2aa198>0x28</span>(<span style=color:#268bd2>%rbp</span>)
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>x</span>/<span style=color:#cb4b16>wx</span> <span style=color:#cb4b16>$rbp-0x28</span>
    0x7fffffffe3a8: 0<span style=color:#268bd2>x0000002a</span></code></pre></div>
<p>Note that the cast to <strong>Integer</strong> &ldquo;grants&rdquo; a <strong>Number</strong> variable access to a field that only <strong>Integer</strong> has defined (<code>val</code>).</p>
<p><img loading=lazy src=/c_poly_cast2.png alt="assembly instructions">
</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm>    <span style=color:#268bd2>int</span> <span style=color:#cb4b16>x</span> = <span style=color:#cb4b16>numbers</span>[<span style=color:#2aa198>0</span>]-&gt;<span style=color:#cb4b16>type</span><span style=color:#586e75>;
</span><span style=color:#586e75></span>    
    <span style=color:#2aa198>0x400618</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>91</span>&gt;      <span style=color:#cb4b16>mov</span>    -<span style=color:#2aa198>0x8</span>(<span style=color:#268bd2>%rbp</span>),<span style=color:#268bd2>%rax</span>
    0<span style=color:#268bd2>x40061c</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>95</span>&gt;      <span style=color:#cb4b16>mov</span>    (<span style=color:#268bd2>%rax</span>),<span style=color:#268bd2>%rax</span>
    0<span style=color:#268bd2>x40061f</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>98</span>&gt;      <span style=color:#cb4b16>mov</span>    (<span style=color:#268bd2>%rax</span>),<span style=color:#268bd2>%eax</span>
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>info</span> <span style=color:#cb4b16>registers</span> <span style=color:#cb4b16>rax</span>
    <span style=color:#268bd2>rax</span>            <span style=color:#2aa198>0x0</span>      <span style=color:#2aa198>0</span>
    
    0<span style=color:#268bd2>x400621</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>100</span>&gt;     <span style=color:#cb4b16>mov</span>    <span style=color:#268bd2>%eax</span>,-<span style=color:#2aa198>0x24</span>(<span style=color:#268bd2>%rbp</span>)
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>x</span>/<span style=color:#cb4b16>wx</span> <span style=color:#cb4b16>$rbp-0x24</span>
    0x7fffffffe3ac: 0<span style=color:#268bd2>x00000000</span></code></pre></div>
<p><img loading=lazy src=/c_poly_cast3.png alt="assembly instructions">
</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm>    <span style=color:#268bd2>x</span> = <span style=color:#cb4b16>numbers</span>[<span style=color:#2aa198>1</span>]-&gt;<span style=color:#cb4b16>type</span><span style=color:#586e75>;
</span><span style=color:#586e75></span>    
    <span style=color:#2aa198>0x400624</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>103</span>&gt;     <span style=color:#cb4b16>mov</span>    -<span style=color:#2aa198>0x8</span>(<span style=color:#268bd2>%rbp</span>),<span style=color:#268bd2>%rax</span>
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>info</span> <span style=color:#cb4b16>registers</span> <span style=color:#cb4b16>rax</span>
    <span style=color:#268bd2>rax</span>            <span style=color:#2aa198>0x602010</span> <span style=color:#2aa198>6299664</span>
    
    0<span style=color:#268bd2>x400628</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>107</span>&gt;     <span style=color:#cb4b16>add</span>    <span style=color:#cb4b16>$0x8</span>,<span style=color:#268bd2>%rax</span>
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>info</span> <span style=color:#cb4b16>registers</span> <span style=color:#cb4b16>rax</span>
    <span style=color:#268bd2>rax</span>            <span style=color:#2aa198>0x602018</span> <span style=color:#2aa198>6299672</span>
    
    0<span style=color:#268bd2>x40062c</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>111</span>&gt;     <span style=color:#cb4b16>mov</span>    (<span style=color:#268bd2>%rax</span>),<span style=color:#268bd2>%rax</span>
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>x</span>/<span style=color:#2aa198>2</span><span style=color:#cb4b16>wx</span> <span style=color:#2aa198>0x602018</span>
    0x602018:       0<span style=color:#268bd2>xffffe3c0</span>      <span style=color:#2aa198>0x00007fff</span>
    
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>x</span>/<span style=color:#cb4b16>wx</span> <span style=color:#2aa198>0x7fffffffe3c0</span>
    0x7fffffffe3c0: 0<span style=color:#268bd2>x00000001</span>
    
    0<span style=color:#268bd2>x40062f</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>114</span>&gt;     <span style=color:#cb4b16>mov</span>    (<span style=color:#268bd2>%rax</span>),<span style=color:#268bd2>%eax</span>
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>info</span> <span style=color:#cb4b16>registers</span> <span style=color:#cb4b16>rax</span>
    <span style=color:#268bd2>rax</span>            <span style=color:#2aa198>0x7fffffffe3c0</span>   <span style=color:#2aa198>140737488348096</span>
    
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>info</span> <span style=color:#cb4b16>registers</span> <span style=color:#cb4b16>eax</span>
    <span style=color:#268bd2>eax</span>            <span style=color:#2aa198>0x1</span>      <span style=color:#2aa198>1</span>
    
    0<span style=color:#268bd2>x400631</span> &lt;<span style=color:#cb4b16>main</span>+<span style=color:#2aa198>116</span>&gt;     <span style=color:#cb4b16>mov</span>    <span style=color:#268bd2>%eax</span>,-<span style=color:#2aa198>0x24</span>(<span style=color:#268bd2>%rbp</span>)
    (<span style=color:#268bd2>gdb</span>) <span style=color:#cb4b16>x</span>/<span style=color:#cb4b16>wx</span> <span style=color:#cb4b16>$rbp-0x24</span>
    0x7fffffffe3ac: 0<span style=color:#268bd2>x00000001</span></code></pre></div>
<p><img loading=lazy src=/c_poly_cast4.png alt="assembly instructions">
</p>
<h3 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h3>
<p>Class inheritance in C is not as elegant/easy as it is in other languages, but it can be achieved. Anyway, as we saw above, there&rsquo;re several pitfalls that could cause damage to you system. Such technique must be used diligently.</p>
<h3 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h3>
<ul>
<li><a href=https://en.wikipedia.org/wiki/Call_stack#Structure>https://en.wikipedia.org/wiki/Call_stack#Structure</a></li>
<li><a href=http://flash-gordon.me.uk/ansi.c.txt>http://flash-gordon.me.uk/ansi.c.txt</a></li>
<li><a href=http://svn.python.org/view/>http://svn.python.org/view/</a></li>
</ul>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://ziviani.net/tags/c/>C</a></li>
<li><a href=https://ziviani.net/tags/python/>Python</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://ziviani.net/posts/binary-index-tree/>
<span class=title>« Prev Page</span>
<br>
<span>Binary Index Tree</span>
</a>
<a class=next href=https://ziviani.net/posts/how-to-create-an-apache-module/>
<span class=title>Next Page »</span>
<br>
<span>How to Create an Apache Module</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://ziviani.net/>ziviani.net</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>