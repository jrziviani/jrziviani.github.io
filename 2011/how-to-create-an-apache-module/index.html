<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>How to Create an Apache Module | ziviani.net</title>
<meta name=keywords content="C,apache,web">
<meta name=description content="A simple how-to guiding through the process of creating an Apache HTTPd module in C language.">
<meta name=author content="Jose R. Ziviani">
<link rel=canonical href=https://jrziviani.github.io/2011/how-to-create-an-apache-module/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<link rel=icon href=https://jrziviani.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://jrziviani.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://jrziviani.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://jrziviani.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://jrziviani.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.0">
<link rel=alternate hreflang=en href=https://jrziviani.github.io/2011/how-to-create-an-apache-module/>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="How to Create an Apache Module">
<meta property="og:description" content="A simple how-to guiding through the process of creating an Apache HTTPd module in C language.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://jrziviani.github.io/2011/how-to-create-an-apache-module/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2011-01-10T13:41:20-08:00">
<meta property="article:modified_time" content="2011-01-10T13:41:20-08:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="How to Create an Apache Module">
<meta name=twitter:description content="A simple how-to guiding through the process of creating an Apache HTTPd module in C language.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://jrziviani.github.io/posts/"},{"@type":"ListItem","position":3,"name":"How to Create an Apache Module","item":"https://jrziviani.github.io/2011/how-to-create-an-apache-module/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to Create an Apache Module","name":"How to Create an Apache Module","description":"A simple how-to guiding through the process of creating an Apache HTTPd module in C language.","keywords":["C","apache","web"],"articleBody":" Update: I wrote a HOWTO guide on how to create an Apache HTTPd module years ago. This is an updated version of the same, that can be found in github.\n Write your own httpd module could be interesting for a number of reasons:\n understand how a webserver works; understand Apache httpd; speed up your current system by optimizing a specific bottleneck; instrumentation; fun?  Warming up So, let’s jump into it. First step is to clone the HTTPd code and build it.\n$ git clone https://github.com/apache/httpd.git $ cd httpd $ git clone https://github.com/apache/apr.git srclib/apr $ ./buildconf $ mkdir mybuild $ cd mybuild $ CFLAGS=\"-O0 -ggdb\" ../configure --enable-rewrite --enable-so --prefix=/home/ziviani/www $ make -j 5 $ make install $ cd /home/ziviani/www $ ls bin build cgi-bin conf error htdocs icons include lib logs man manual modules  Check whether the server is working (I set it with high port to run it as a normal user):\n$ # still in /home/ziviani/www $ vi conf/httpd.conf ... LISTEN 9898 ... ServerName localhost:9898 ... $ bin/apachectl -k start  $ bin/apachectl -k stop  My Module Now we have the httpd source code that compiles and runs, let’s create our first module.\n$ bin/apxs -g -n my_fast_server Creating [DIR] my_fast_server Creating [FILE] my_fast_server/Makefile Creating [FILE] my_fast_server/modules.mk Creating [FILE] my_fast_server/mod_my_fast_server.c Creating [FILE] my_fast_server/.deps $ vim my_fast_server/mod_my_fast_server.c  Easy thing, huh? apxs just created a template (thanks to -g option) for us. The instructions in the comment section explains how to build and configure it.\n1 /* 2** mod_my_fast_server.c -- Apache sample my_fast_server module 3** [Autogenerated via ``apxs -n my_fast_server -g''] 4** 5** To play with this sample module first compile it into a 6** DSO file and install it into Apache's modules directory 7** by running: 8** 9** $ apxs -c -i mod_my_fast_server.c 10** 11** Then activate it in Apache's httpd.conf file for instance 12** for the URL /my_fast_server in as follows: 13** 14** # httpd.conf 15** LoadModule my_fast_server_module modules/mod_my_fast_server.so 16** 17** SetHandler my_fast_server 18**  19** 20** Then after restarting Apache via 21** 22** $ apachectl restart 23** 24** you immediately can request the URL /my_fast_server and watch for the 25** output of this module. This can be achieved for instance via: 26** 27** $ lynx -mime_header http://localhost/my_fast_server 28** 29** The output should be similar to the following one: 30** 31** HTTP/1.1 200 OK 32** Date: Tue, 31 Mar 1998 14:42:22 GMT 33** Server: Apache/1.3.4 (Unix) 34** Connection: close 35** Content-Type: text/html 36** 37** The sample page from mod_my_fast_server.c 38*/ 39 #include \"httpd.h\"40 #include \"http_config.h\"41 #include \"http_protocol.h\"42 #include \"ap_config.h\"43 44 /* The sample content handler */ 45 static int my_fast_server_handler(request_rec *r) 46 { 47 if (strcmp(r-handler, \"my_fast_server\")) { 48 return DECLINED; 49 } 50 r-content_type = \"text/html\"; 51 52 if (!r-header_only) 53 ap_rputs(\"The sample page from mod_my_fast_server.c\\n\", r); 54 return OK; 55 } 56 57 static void my_fast_server_register_hooks(apr_pool_t *p) 58 { 59 ap_hook_handler(my_fast_server_handler, NULL, NULL, APR_HOOK_MIDDLE); 60 } 61 62 /* Dispatch list for API hooks */ 63 module AP_MODULE_DECLARE_DATA my_fast_server_module = { 64 STANDARD20_MODULE_STUFF, 65 NULL, /* create per-dir config structures */ 66 NULL, /* merge per-dir config structures */ 67 NULL, /* create per-server config structures */ 68 NULL, /* merge per-server config structures */ 69 NULL, /* table of config file commands */ 70 my_fast_server_register_hooks /* register hooks */ 71 }; I made some changes in mod_my_fast_server.c. Nothing big, just make it prints browser’s query string.\n1 #include \"httpd.h\"2 #include \"http_config.h\"3 #include \"http_protocol.h\"4 #include \"ap_config.h\"5 6 #define MAX_HANDLER 4 7 8 typedef int (*method_handler)(request_rec *r); 9 10 // HTTP Get method handler 11 static int get_handler(request_rec *r); 12 13 // HTTP Post method handler 14 static int post_handler(request_rec *r); 15 16 // HTTP Put method handler 17 static int put_handler(request_rec *r); 18 19 // HTTP Delete method handler 20 static int delete_handler(request_rec *r); 21 22 /* The sample content handler */ 23 static int my_fast_server_handler(request_rec *r) 24 { 25 if (strcmp(r-handler, \"my_fast_server\")) { 26 return DECLINED; 27 } 28 r-content_type = \"text/html\"; 29 30 // as per httpd.h r-method_number gives a numeric representation of http 31 // method: 0 - get, 1 - put, 2 - post, 3 - delete, etc 32 method_handler methods[MAX_HANDLER] = {\u0026get_handler, \u0026put_handler, 33 \u0026post_handler, \u0026delete_handler}; 34 35 if (r-method_number = MAX_HANDLER || r-method_number  0) { 36 return DECLINED; 37 } 38 39 // call the handler function 40 return methods[r-method_number](r); 41 } 42 43 static int get_handler(request_rec *r) 44 { 45 apr_status_t rv; 46 int i = 0; 47 int n = 0; 48 char* query = r-args; // query string 49 50 // mime type send to the called 51 r-content_type = \"text/html\"; 52 53 // return OK if only header requested or no argument 54 if (r-header_only || r-args == 0) { 55 return OK; 56 } 57 58 ap_rprintf(r, \"[GET] Your query string: %s\", query); 59 60 return OK; 61 } 62 63 // Post http handler 64 static int post_handler(request_rec *r) 65 { 66 return OK; 67 } 68 69 // Put http handler 70 static int put_handler(request_rec *r) 71 { 72 return OK; 73 } 74 75 // Delete http handler 76 static int delete_handler(request_rec *r) 77 { 78 return OK; 79 } 80 81 static void my_fast_server_register_hooks(apr_pool_t *p) 82 { 83 ap_hook_handler(my_fast_server_handler, NULL, NULL, APR_HOOK_MIDDLE); 84 } 85 86 /* Dispatch list for API hooks */ 87 module AP_MODULE_DECLARE_DATA my_fast_server_module = { 88 STANDARD20_MODULE_STUFF, 89 NULL, /* create per-dir config structures */ 90 NULL, /* merge per-dir config structures */ 91 NULL, /* create per-server config structures */ 92 NULL, /* merge per-server config structures */ 93 NULL, /* table of config file commands */ 94 my_fast_server_register_hooks /* register hooks */ 95 }; Now, compile it to build a DSO and install that DSO in the modules directory (apxs does that automatically):\n$ bin/apxs -c -i my_fast_server/mod_my_fast_server.c /home/ziviani/www/build/libtool --silent --mode=compile gcc ... ... ---------------------------------------------------------------------- Libraries have been installed in: /home/ziviani/www/modules If you ever happen to want to link against installed libraries in a given directory, LIBDIR, you must either use libtool, and specify the full pathname of the library, or use the '-LLIBDIR' flag during linking and do at least one of the following: - add LIBDIR to the 'LD_LIBRARY_PATH' environment variable during execution - add LIBDIR to the 'LD_RUN_PATH' environment variable during linking - use the '-Wl,-rpath -Wl,LIBDIR' linker flag - have your system administrator add LIBDIR to '/etc/ld.so.conf' See any operating system documentation about shared libraries for more information, such as the ld(1) and ld.so(8) manual pages. ---------------------------------------------------------------------- chmod 755 /home/ziviani/www/modules/mod_my_fast_server.so  And that’s all! You only need to configure httpd.conf, start the server and use it.\n$ vim conf/httpd.conf ... LoadModule my_fast_server_module modules/mod_my_fast_server.so SetHandler my_fast_server  ... $ bin/apachectl -k start  Open your browse and navigate it to http://localhost:9898/my_fast_server?test\u0026query=bla to see the query string printed.\nExtra: static (no apxs) build Suppose you don’t want to use apxs and want to build your module together with httpd itself.\nI’ll reuse the same source file and add my module in the Apache httpd build system. The steps are following:\n copy the my_fast_server folder into httpd main source folder; add my_fast_server in httpd build system; call buildconf again to re-generate autoconf; build!  Example:\n$ cp -a my_fast_server ~/httpd/modules/ $ cd ~/httpd $ vim my_fast_server/config.m4 APACHE_MODPATH_INIT(my_fast_server) APACHE_MODULE(my_fast_server, My FAST server!, , , no) APACHE_MODPATH_FINISH $ vim my_fast_server/Makefile.in include $(top_srcdir)/build/special.mk $ ./buildconf $ cd mybuild $ ../configure --help ... --disable-version determining httpd version in config files --enable-remoteip translate header contents to an apparent client remote_ip --enable-my-fast-server My FAST!! server  If the build finished without any errors, you can test your new module. Go to the www folder, edit conf/httpd.conf and start the server.\n$ vim conf/httpd.conf ... LoadModule my_fast_server_module modules/mod_my_fast_server.so SetHandler my_fast_server  ... $ bin/apachectl -k start  Navigate it to http://localhost:9898/my_fast_server?test\u0026query=bla to see the query string printed.\nReferences  http://apr.apache.org/docs/apr/1.4/modules.html http://httpd.apache.org/docs/2.1/ http://httpd.apache.org/docs/2.1/mod/mod_dbd.html http://blog.projectfondue.com/2009/8/25/apache-moving-from-prefork-to-worker  ","wordCount":"1327","inLanguage":"en","datePublished":"2011-01-10T13:41:20-08:00","dateModified":"2011-01-10T13:41:20-08:00","author":{"@type":"Person","name":"Jose R. Ziviani"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://jrziviani.github.io/2011/how-to-create-an-apache-module/"},"publisher":{"@type":"Organization","name":"ziviani.net","logo":{"@type":"ImageObject","url":"https://jrziviani.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://jrziviani.github.io accesskey=h title="ziviani.net (Alt + H)">ziviani.net</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
<ul class=lang-switch><li>|</li>
<li>
<a href=https://jrziviani.github.io/pt/ title=Portuguese aria-label=:pt:>Pt</a>
</li>
</ul>
</span>
</div>
<ul id=menu>
<li>
<a href=https://jrziviani.github.io/archives title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://jrziviani.github.io/search title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
<li>
<a href=https://jrziviani.github.io/tags title=Tags>
<span>Tags</span>
</a>
</li>
<li>
<a href=https://jrziviani.github.io/about title=About>
<span>About</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://jrziviani.github.io>Home</a>&nbsp;»&nbsp;<a href=https://jrziviani.github.io/posts/>Posts</a></div>
<h1 class=post-title>
How to Create an Apache Module
</h1>
<div class=post-meta><span title="2011-01-10 13:41:20 -0800 -0800">January 10, 2011</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;Jose R. Ziviani
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#warming-up aria-label="Warming up">Warming up</a></li>
<li>
<a href=#my-module aria-label="My Module">My Module</a></li>
<li>
<a href=#extra-static-no-apxs-build aria-label="Extra: static (no apxs) build">Extra: static (no apxs) build</a></li>
<li>
<a href=#references aria-label=References>References</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><blockquote>
<p><strong>Update</strong>: I wrote a HOWTO guide on how to create an Apache HTTPd module years ago. This is an updated version of the same, that can be found in <a href=https://github.com/jrziviani/apache_module>github</a>.</p>
</blockquote>
<p>Write your own httpd module could be interesting for a number of reasons:</p>
<ul>
<li>understand how a webserver works;</li>
<li>understand Apache httpd;</li>
<li>speed up your current system by optimizing a specific bottleneck;</li>
<li>instrumentation;</li>
<li>fun?</li>
</ul>
<h3 id=warming-up>Warming up<a hidden class=anchor aria-hidden=true href=#warming-up>#</a></h3>
<p>So, let&rsquo;s jump into it. First step is to clone the HTTPd code and build it.</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console>    $ git clone https://github.com/apache/httpd.git
    $ cd httpd
    $ git clone https://github.com/apache/apr.git srclib/apr
    $ ./buildconf
    $ mkdir mybuild
    $ cd mybuild
    $ CFLAGS=&#34;-O0 -ggdb&#34; ../configure --enable-rewrite --enable-so --prefix=/home/ziviani/www
    $ make -j 5
    $ make install
    $ cd /home/ziviani/www
    $ ls
    bin  build  cgi-bin  conf  error  htdocs  icons  include  lib  logs  man  manual  modules
</code></pre></div>
<p>Check whether the server is working (I set it with high port to run it as a normal user):</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console>    $ # still in /home/ziviani/www
    $ vi conf/httpd.conf
    ...
    LISTEN 9898
    ...
    ServerName localhost:9898
    ...
    
    $ bin/apachectl -k start
</code></pre></div>
<p><img loading=lazy src=/apache_works1.png alt="apache initial works page">
</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console>    $ bin/apachectl -k stop
</code></pre></div>
<h3 id=my-module>My Module<a hidden class=anchor aria-hidden=true href=#my-module>#</a></h3>
<p>Now we have the httpd source code that compiles and runs, let&rsquo;s create our first module.</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console>    $ bin/apxs -g -n my_fast_server
    Creating [DIR]  my_fast_server
    Creating [FILE] my_fast_server/Makefile
    Creating [FILE] my_fast_server/modules.mk
    Creating [FILE] my_fast_server/mod_my_fast_server.c
    Creating [FILE] my_fast_server/.deps
    
    $ vim my_fast_server/mod_my_fast_server.c
</code></pre></div>
<p>Easy thing, huh? <code>apxs</code> just created a template (thanks to -g option) for us. The instructions in the comment section explains how to build and configure it.</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 1</span>    <span style=color:#586e75>/*
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 2</span><span style=color:#586e75>    **  mod_my_fast_server.c -- Apache sample my_fast_server module
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 3</span><span style=color:#586e75>    **  [Autogenerated via ``apxs -n my_fast_server -g&#39;&#39;]
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 4</span><span style=color:#586e75>    **
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 5</span><span style=color:#586e75>    **  To play with this sample module first compile it into a
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 6</span><span style=color:#586e75>    **  DSO file and install it into Apache&#39;s modules directory 
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 7</span><span style=color:#586e75>    **  by running:
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 8</span><span style=color:#586e75>    **
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 9</span><span style=color:#586e75>    **    $ apxs -c -i mod_my_fast_server.c
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">10</span><span style=color:#586e75>    **
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">11</span><span style=color:#586e75>    **  Then activate it in Apache&#39;s httpd.conf file for instance
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">12</span><span style=color:#586e75>    **  for the URL /my_fast_server in as follows:
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">13</span><span style=color:#586e75>    **
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">14</span><span style=color:#586e75>    **    #   httpd.conf
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">15</span><span style=color:#586e75>    **    LoadModule my_fast_server_module modules/mod_my_fast_server.so
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">16</span><span style=color:#586e75>    **    &lt;Location /my_fast_server&gt;
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">17</span><span style=color:#586e75>    **    SetHandler my_fast_server
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">18</span><span style=color:#586e75>    **    &lt;/Location&gt;
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">19</span><span style=color:#586e75>    **
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">20</span><span style=color:#586e75>    **  Then after restarting Apache via
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">21</span><span style=color:#586e75>    **
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">22</span><span style=color:#586e75>    **    $ apachectl restart
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">23</span><span style=color:#586e75>    **
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">24</span><span style=color:#586e75>    **  you immediately can request the URL /my_fast_server and watch for the
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">25</span><span style=color:#586e75>    **  output of this module. This can be achieved for instance via:
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">26</span><span style=color:#586e75>    **
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">27</span><span style=color:#586e75>    **    $ lynx -mime_header http://localhost/my_fast_server 
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">28</span><span style=color:#586e75>    **
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">29</span><span style=color:#586e75>    **  The output should be similar to the following one:
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">30</span><span style=color:#586e75>    **
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">31</span><span style=color:#586e75>    **    HTTP/1.1 200 OK
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">32</span><span style=color:#586e75>    **    Date: Tue, 31 Mar 1998 14:42:22 GMT
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">33</span><span style=color:#586e75>    **    Server: Apache/1.3.4 (Unix)
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">34</span><span style=color:#586e75>    **    Connection: close
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">35</span><span style=color:#586e75>    **    Content-Type: text/html
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">36</span><span style=color:#586e75>    **
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">37</span><span style=color:#586e75>    **    The sample page from mod_my_fast_server.c
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">38</span><span style=color:#586e75>    */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">39</span>    <span style=color:#719e07>#include</span> <span style=color:#719e07>&#34;httpd.h&#34;</span><span style=color:#719e07>
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">40</span><span style=color:#719e07></span>    <span style=color:#719e07>#include</span> <span style=color:#719e07>&#34;http_config.h&#34;</span><span style=color:#719e07>
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">41</span><span style=color:#719e07></span>    <span style=color:#719e07>#include</span> <span style=color:#719e07>&#34;http_protocol.h&#34;</span><span style=color:#719e07>
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">42</span><span style=color:#719e07></span>    <span style=color:#719e07>#include</span> <span style=color:#719e07>&#34;ap_config.h&#34;</span><span style=color:#719e07>
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">43</span><span style=color:#719e07></span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">44</span>    <span style=color:#586e75>/* The sample content handler */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">45</span>    <span style=color:#719e07>static</span> <span style=color:#dc322f>int</span> <span style=color:#268bd2>my_fast_server_handler</span>(request_rec <span style=color:#719e07>*</span>r)
<span style="margin-right:.4em;padding:0 .4em;color:#495050">46</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">47</span>        <span style=color:#719e07>if</span> (strcmp(r<span style=color:#719e07>-&gt;</span>handler, <span style=color:#2aa198>&#34;my_fast_server&#34;</span>)) {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">48</span>            <span style=color:#719e07>return</span> DECLINED;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">49</span>        }
<span style="margin-right:.4em;padding:0 .4em;color:#495050">50</span>        r<span style=color:#719e07>-&gt;</span>content_type <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;text/html&#34;</span>;      
<span style="margin-right:.4em;padding:0 .4em;color:#495050">51</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">52</span>        <span style=color:#719e07>if</span> (<span style=color:#719e07>!</span>r<span style=color:#719e07>-&gt;</span>header_only)
<span style="margin-right:.4em;padding:0 .4em;color:#495050">53</span>            ap_rputs(<span style=color:#2aa198>&#34;The sample page from mod_my_fast_server.c</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>, r);
<span style="margin-right:.4em;padding:0 .4em;color:#495050">54</span>        <span style=color:#719e07>return</span> OK;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">55</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#495050">56</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">57</span>    <span style=color:#719e07>static</span> <span style=color:#dc322f>void</span> <span style=color:#268bd2>my_fast_server_register_hooks</span>(apr_pool_t <span style=color:#719e07>*</span>p)
<span style="margin-right:.4em;padding:0 .4em;color:#495050">58</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">59</span>        ap_hook_handler(my_fast_server_handler, <span style=color:#b58900>NULL</span>, <span style=color:#b58900>NULL</span>, APR_HOOK_MIDDLE);
<span style="margin-right:.4em;padding:0 .4em;color:#495050">60</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#495050">61</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">62</span>    <span style=color:#586e75>/* Dispatch list for API hooks */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">63</span>    module AP_MODULE_DECLARE_DATA my_fast_server_module <span style=color:#719e07>=</span> {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">64</span>        STANDARD20_MODULE_STUFF, 
<span style="margin-right:.4em;padding:0 .4em;color:#495050">65</span>        <span style=color:#b58900>NULL</span>,                  <span style=color:#586e75>/* create per-dir    config structures */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">66</span>        <span style=color:#b58900>NULL</span>,                  <span style=color:#586e75>/* merge  per-dir    config structures */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">67</span>        <span style=color:#b58900>NULL</span>,                  <span style=color:#586e75>/* create per-server config structures */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">68</span>        <span style=color:#b58900>NULL</span>,                  <span style=color:#586e75>/* merge  per-server config structures */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">69</span>        <span style=color:#b58900>NULL</span>,                  <span style=color:#586e75>/* table of config file commands       */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">70</span>        my_fast_server_register_hooks  <span style=color:#586e75>/* register hooks              */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">71</span>    };</code></pre></div>
<p>I made some changes in <code>mod_my_fast_server.c</code>. Nothing big, just make it prints browser&rsquo;s query string.</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 1</span>    <span style=color:#719e07>#include</span> <span style=color:#719e07>&#34;httpd.h&#34;</span><span style=color:#719e07>
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 2</span><span style=color:#719e07></span>    <span style=color:#719e07>#include</span> <span style=color:#719e07>&#34;http_config.h&#34;</span><span style=color:#719e07>
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 3</span><span style=color:#719e07></span>    <span style=color:#719e07>#include</span> <span style=color:#719e07>&#34;http_protocol.h&#34;</span><span style=color:#719e07>
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 4</span><span style=color:#719e07></span>    <span style=color:#719e07>#include</span> <span style=color:#719e07>&#34;ap_config.h&#34;</span><span style=color:#719e07>
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 5</span><span style=color:#719e07></span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050"> 6</span>    <span style=color:#719e07>#define MAX_HANDLER 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 7</span><span style=color:#719e07></span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050"> 8</span>    <span style=color:#719e07>typedef</span> <span style=color:#268bd2>int</span> (<span style=color:#719e07>*</span>method_handler)(request_rec <span style=color:#719e07>*</span>r);
<span style="margin-right:.4em;padding:0 .4em;color:#495050"> 9</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">10</span>    <span style=color:#586e75>// HTTP Get method handler
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">11</span><span style=color:#586e75></span>    <span style=color:#719e07>static</span> <span style=color:#dc322f>int</span> <span style=color:#268bd2>get_handler</span>(request_rec <span style=color:#719e07>*</span>r);
<span style="margin-right:.4em;padding:0 .4em;color:#495050">12</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">13</span>    <span style=color:#586e75>// HTTP Post method handler
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">14</span><span style=color:#586e75></span>    <span style=color:#719e07>static</span> <span style=color:#dc322f>int</span> <span style=color:#268bd2>post_handler</span>(request_rec <span style=color:#719e07>*</span>r);
<span style="margin-right:.4em;padding:0 .4em;color:#495050">15</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">16</span>    <span style=color:#586e75>// HTTP Put method handler
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">17</span><span style=color:#586e75></span>    <span style=color:#719e07>static</span> <span style=color:#dc322f>int</span> <span style=color:#268bd2>put_handler</span>(request_rec <span style=color:#719e07>*</span>r);
<span style="margin-right:.4em;padding:0 .4em;color:#495050">18</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">19</span>    <span style=color:#586e75>// HTTP Delete method handler
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">20</span><span style=color:#586e75></span>    <span style=color:#719e07>static</span> <span style=color:#dc322f>int</span> <span style=color:#268bd2>delete_handler</span>(request_rec <span style=color:#719e07>*</span>r);
<span style="margin-right:.4em;padding:0 .4em;color:#495050">21</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">22</span>    <span style=color:#586e75>/* The sample content handler */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">23</span>    <span style=color:#719e07>static</span> <span style=color:#dc322f>int</span> <span style=color:#268bd2>my_fast_server_handler</span>(request_rec <span style=color:#719e07>*</span>r)
<span style="margin-right:.4em;padding:0 .4em;color:#495050">24</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">25</span>        <span style=color:#719e07>if</span> (strcmp(r<span style=color:#719e07>-&gt;</span>handler, <span style=color:#2aa198>&#34;my_fast_server&#34;</span>)) {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">26</span>            <span style=color:#719e07>return</span> DECLINED;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">27</span>        }
<span style="margin-right:.4em;padding:0 .4em;color:#495050">28</span>        r<span style=color:#719e07>-&gt;</span>content_type <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;text/html&#34;</span>;      
<span style="margin-right:.4em;padding:0 .4em;color:#495050">29</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">30</span>        <span style=color:#586e75>// as per httpd.h r-&gt;method_number gives a numeric representation of http
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">31</span><span style=color:#586e75></span>        <span style=color:#586e75>// method: 0 - get, 1 - put, 2 - post, 3 - delete, etc
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">32</span><span style=color:#586e75></span>        method_handler methods[MAX_HANDLER] <span style=color:#719e07>=</span> {<span style=color:#719e07>&amp;</span>get_handler, <span style=color:#719e07>&amp;</span>put_handler,
<span style="margin-right:.4em;padding:0 .4em;color:#495050">33</span>            <span style=color:#719e07>&amp;</span>post_handler, <span style=color:#719e07>&amp;</span>delete_handler};
<span style="margin-right:.4em;padding:0 .4em;color:#495050">34</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">35</span>        <span style=color:#719e07>if</span> (r<span style=color:#719e07>-&gt;</span>method_number <span style=color:#719e07>&gt;=</span> MAX_HANDLER <span style=color:#719e07>||</span> r<span style=color:#719e07>-&gt;</span>method_number <span style=color:#719e07>&lt;</span> <span style=color:#2aa198>0</span>) {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">36</span>            <span style=color:#719e07>return</span> DECLINED;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">37</span>        }
<span style="margin-right:.4em;padding:0 .4em;color:#495050">38</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">39</span>        <span style=color:#586e75>// call the handler function
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">40</span><span style=color:#586e75></span>        <span style=color:#719e07>return</span> methods[r<span style=color:#719e07>-&gt;</span>method_number](r);
<span style="margin-right:.4em;padding:0 .4em;color:#495050">41</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#495050">42</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">43</span>    <span style=color:#719e07>static</span> <span style=color:#dc322f>int</span> <span style=color:#268bd2>get_handler</span>(request_rec <span style=color:#719e07>*</span>r)
<span style="margin-right:.4em;padding:0 .4em;color:#495050">44</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">45</span>        apr_status_t rv;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">46</span>        <span style=color:#dc322f>int</span> i <span style=color:#719e07>=</span> <span style=color:#2aa198>0</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">47</span>        <span style=color:#dc322f>int</span> n <span style=color:#719e07>=</span> <span style=color:#2aa198>0</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">48</span>        <span style=color:#dc322f>char</span><span style=color:#719e07>*</span> query <span style=color:#719e07>=</span> r<span style=color:#719e07>-&gt;</span>args; <span style=color:#586e75>// query string
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">49</span><span style=color:#586e75></span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">50</span>        <span style=color:#586e75>// mime type send to the called
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">51</span><span style=color:#586e75></span>        r<span style=color:#719e07>-&gt;</span>content_type <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;text/html&#34;</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">52</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">53</span>        <span style=color:#586e75>// return OK if only header requested or no argument
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">54</span><span style=color:#586e75></span>        <span style=color:#719e07>if</span> (r<span style=color:#719e07>-&gt;</span>header_only <span style=color:#719e07>||</span> r<span style=color:#719e07>-&gt;</span>args <span style=color:#719e07>==</span> <span style=color:#2aa198>0</span>) {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">55</span>            <span style=color:#719e07>return</span> OK;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">56</span>        }
<span style="margin-right:.4em;padding:0 .4em;color:#495050">57</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">58</span>        ap_rprintf(r, <span style=color:#2aa198>&#34;&lt;h1&gt;[GET] Your query string: %s&lt;/h1&gt;&#34;</span>, query);
<span style="margin-right:.4em;padding:0 .4em;color:#495050">59</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">60</span>        <span style=color:#719e07>return</span> OK;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">61</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#495050">62</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">63</span>    <span style=color:#586e75>// Post http handler
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">64</span><span style=color:#586e75></span>    <span style=color:#719e07>static</span> <span style=color:#dc322f>int</span> <span style=color:#268bd2>post_handler</span>(request_rec <span style=color:#719e07>*</span>r)
<span style="margin-right:.4em;padding:0 .4em;color:#495050">65</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">66</span>        <span style=color:#719e07>return</span> OK;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">67</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#495050">68</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">69</span>    <span style=color:#586e75>// Put http handler
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">70</span><span style=color:#586e75></span>    <span style=color:#719e07>static</span> <span style=color:#dc322f>int</span> <span style=color:#268bd2>put_handler</span>(request_rec <span style=color:#719e07>*</span>r)
<span style="margin-right:.4em;padding:0 .4em;color:#495050">71</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">72</span>        <span style=color:#719e07>return</span> OK;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">73</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#495050">74</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">75</span>    <span style=color:#586e75>// Delete http handler
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">76</span><span style=color:#586e75></span>    <span style=color:#719e07>static</span> <span style=color:#dc322f>int</span> <span style=color:#268bd2>delete_handler</span>(request_rec <span style=color:#719e07>*</span>r)
<span style="margin-right:.4em;padding:0 .4em;color:#495050">77</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">78</span>        <span style=color:#719e07>return</span> OK;
<span style="margin-right:.4em;padding:0 .4em;color:#495050">79</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#495050">80</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">81</span>    <span style=color:#719e07>static</span> <span style=color:#dc322f>void</span> <span style=color:#268bd2>my_fast_server_register_hooks</span>(apr_pool_t <span style=color:#719e07>*</span>p)
<span style="margin-right:.4em;padding:0 .4em;color:#495050">82</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">83</span>        ap_hook_handler(my_fast_server_handler, <span style=color:#b58900>NULL</span>, <span style=color:#b58900>NULL</span>, APR_HOOK_MIDDLE);
<span style="margin-right:.4em;padding:0 .4em;color:#495050">84</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#495050">85</span>    
<span style="margin-right:.4em;padding:0 .4em;color:#495050">86</span>    <span style=color:#586e75>/* Dispatch list for API hooks */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">87</span>    module AP_MODULE_DECLARE_DATA my_fast_server_module <span style=color:#719e07>=</span> {
<span style="margin-right:.4em;padding:0 .4em;color:#495050">88</span>        STANDARD20_MODULE_STUFF, 
<span style="margin-right:.4em;padding:0 .4em;color:#495050">89</span>        <span style=color:#b58900>NULL</span>,                  <span style=color:#586e75>/* create per-dir    config structures */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">90</span>        <span style=color:#b58900>NULL</span>,                  <span style=color:#586e75>/* merge  per-dir    config structures */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">91</span>        <span style=color:#b58900>NULL</span>,                  <span style=color:#586e75>/* create per-server config structures */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">92</span>        <span style=color:#b58900>NULL</span>,                  <span style=color:#586e75>/* merge  per-server config structures */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">93</span>        <span style=color:#b58900>NULL</span>,                  <span style=color:#586e75>/* table of config file commands       */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">94</span>        my_fast_server_register_hooks  <span style=color:#586e75>/* register hooks              */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#495050">95</span>    };</code></pre></div>
<p>Now, compile it to build a DSO and install that DSO in the modules directory (<code>apxs</code> does that automatically):</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console>    $ bin/apxs -c -i my_fast_server/mod_my_fast_server.c
    
    /home/ziviani/www/build/libtool --silent --mode=compile gcc ...
    ...
    ----------------------------------------------------------------------
    Libraries have been installed in:
       /home/ziviani/www/modules
    
    If you ever happen to want to link against installed libraries
    in a given directory, LIBDIR, you must either use libtool, and
    specify the full pathname of the library, or use the &#39;-LLIBDIR&#39;
    flag during linking and do at least one of the following:
       - add LIBDIR to the &#39;LD_LIBRARY_PATH&#39; environment variable
         during execution
       - add LIBDIR to the &#39;LD_RUN_PATH&#39; environment variable
         during linking
       - use the &#39;-Wl,-rpath -Wl,LIBDIR&#39; linker flag
       - have your system administrator add LIBDIR to &#39;/etc/ld.so.conf&#39;
    
    See any operating system documentation about shared libraries for
    more information, such as the ld(1) and ld.so(8) manual pages.
    ----------------------------------------------------------------------
    chmod 755 /home/ziviani/www/modules/mod_my_fast_server.so
</code></pre></div>
<p>And that&rsquo;s all! You only need to configure <code>httpd.conf</code>, start the server and use it.</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console>    $ vim conf/httpd.conf
    ...
    LoadModule my_fast_server_module modules/mod_my_fast_server.so
    &lt;Location /my_fast_server&gt;
        SetHandler my_fast_server
    &lt;/Location&gt;
    ...
    
    $ bin/apachectl -k start
</code></pre></div>
<p>Open your browse and navigate it to <code>http://localhost:9898/my_fast_server?test&query=bla</code> to see the query string printed.</p>
<p><img loading=lazy src=/apache_works2.png alt="apache initial works page">
</p>
<h3 id=extra-static-no-apxs-build>Extra: static (no apxs) build<a hidden class=anchor aria-hidden=true href=#extra-static-no-apxs-build>#</a></h3>
<p>Suppose you don&rsquo;t want to use <code>apxs</code> and want to build your module together with httpd itself.</p>
<p>I&rsquo;ll reuse the same source file and add my module in the Apache httpd build system. The steps are following:</p>
<ul>
<li>copy the my_fast_server folder into httpd main source folder;</li>
<li>add my_fast_server in httpd build system;</li>
<li>call buildconf again to re-generate autoconf;</li>
<li>build!</li>
</ul>
<p>Example:</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console>    $ cp -a my_fast_server ~/httpd/modules/
    $ cd ~/httpd
    
    $ vim my_fast_server/config.m4
    
    APACHE_MODPATH_INIT(my_fast_server)
    APACHE_MODULE(my_fast_server, My FAST server!, , , no)
    APACHE_MODPATH_FINISH
    
    $ vim my_fast_server/Makefile.in
    
    include $(top_srcdir)/build/special.mk
    
    $ ./buildconf
    
    $ cd mybuild
    $ ../configure --help
    ...
      --disable-version       determining httpd version in config files
      --enable-remoteip       translate header contents to an apparent client
                              remote_ip
      --enable-my-fast-server My FAST!! server  &lt;===== Yay!!!
      --enable-proxy          Apache proxy module
      --enable-proxy-connect  Apache proxy CONNECT module. Requires
    ...
    
    $ CFLAGS=&#34;-O0 -ggdb&#34; ../configure --enable-rewrite --enable-so --enable-my-fast-server --prefix=/home/ziviani/www
    $ make
    $ make install
</code></pre></div>
<p>If the build finished without any errors, you can test your new module. Go to the <code>www</code> folder, edit <code>conf/httpd.conf</code> and start the server.</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console>    $ vim conf/httpd.conf
    ...
    LoadModule my_fast_server_module modules/mod_my_fast_server.so
    &lt;Location /my_fast_server&gt;
        SetHandler my_fast_server
    &lt;/Location&gt;
    ...
    
    $ bin/apachectl -k start
</code></pre></div>
<p>Navigate it to <code>http://localhost:9898/my_fast_server?test&query=bla</code> to see the query string printed.</p>
<p><img loading=lazy src=/apache_works3.png alt="apache initial works page">
</p>
<h3 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h3>
<ul>
<li><a href=https://apr.apache.org/docs/apr/1.4/modules.html>http://apr.apache.org/docs/apr/1.4/modules.html</a></li>
<li><a href=https://httpd.apache.org/docs/2.1/>http://httpd.apache.org/docs/2.1/</a></li>
<li><a href=https://httpd.apache.org/docs/2.1/mod/mod_dbd.html>http://httpd.apache.org/docs/2.1/mod/mod_dbd.html</a></li>
<li><a href=http://blog.projectfondue.com/2009/8/25/apache-moving-from-prefork-to-worker>http://blog.projectfondue.com/2009/8/25/apache-moving-from-prefork-to-worker</a></li>
</ul>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://jrziviani.github.io/tags/c/>C</a></li>
<li><a href=https://jrziviani.github.io/tags/apache/>apache</a></li>
<li><a href=https://jrziviani.github.io/tags/web/>web</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://jrziviani.github.io/2014/class-inheritance-in-c/>
<span class=title>« Prev Page</span>
<br>
<span>Class Inheritance in C</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://jrziviani.github.io>ziviani.net</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>